<div class="summary-container" *transloco="let t">
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ t("steps.progressReport.step2") }}</mat-card-title>
      <mat-card-subtitle>Step 2</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <drr-summary-item
        [label]="t('progressReport.projectProgress')"
        [rxFormControl]="progressReportForm.get('workplan.projectProgress')"
        controlType="select"
        translatePrefix="projectProgress"
      ></drr-summary-item>
      @if (
        progressReportForm.get("workplan.projectProgress")?.value ===
        "AheadOfSchedule"
      ) {
        <drr-summary-item
          [label]="t('progressReport.aheadOfScheduleComments')"
          [rxFormControl]="
            progressReportForm.get('workplan.aheadOfScheduleComments')
          "
          controlType="textarea"
        ></drr-summary-item>
      }
      @if (
        progressReportForm.get("workplan.projectProgress")?.value ===
        "BehindSchedule"
      ) {
        <drr-summary-item
          [label]="t('progressReport.delayReason')"
          [rxFormControl]="progressReportForm.get('workplan.delayReason')"
          controlType="select"
          translatePrefix="delayReason"
        ></drr-summary-item>

        @if (
          progressReportForm.get("workplan.delayReason")?.value === "Other"
        ) {
          <drr-summary-item
            [label]="t('progressReport.otherDelayReason')"
            [rxFormControl]="
              progressReportForm.get('workplan.otherDelayReason')
            "
            controlType="textarea"
          ></drr-summary-item>
        }

        <drr-summary-item
          [label]="t('progressReport.behindScheduleMitigatingComments')"
          [rxFormControl]="
            progressReportForm.get('workplan.behindScheduleMitigatingComments')
          "
          controlType="textarea"
        ></drr-summary-item>
      }
      <drr-summary-item
        [label]="t('progressReport.projectCompletionPercentage')"
        [rxFormControl]="
          progressReportForm.get('workplan.projectCompletionPercentage')
        "
        [value]="
          progressReportForm.get('workplan.projectCompletionPercentage')
            ?.value + '%'
        "
      ></drr-summary-item>
      @if (progressReportForm.get("projectType")?.value === "Stream2") {
        <drr-summary-item
          [label]="t('progressReport.constructionCompletionPercentage')"
          [rxFormControl]="
            progressReportForm.get('workplan.constructionCompletionPercentage')
          "
          [value]="
            progressReportForm.get('workplan.constructionCompletionPercentage')
              ?.value + '%'
          "
        ></drr-summary-item>
      }

      <mat-label class="drr-label">Key Activities</mat-label>
      <div
        style="display: flex; flex-direction: column; gap: 1rem"
        *ngFor="let activity of getPreDefinedActivitiesArray(); let i = index"
      >
        <div class="summary-row">
          <drr-summary-item
            [label]="t('progressReport.activity')"
            [rxFormControl]="activity.get('activity')"
            controlType="select"
            translatePrefix="activityType"
          ></drr-summary-item>
          <drr-summary-item
            [label]="t('progressReport.status')"
            [rxFormControl]="activity.get('status')"
            controlType="select"
            translatePrefix="workplanStatus"
          ></drr-summary-item>
          @if (showPlannedStartDate(activity)) {
            <drr-summary-item
              [label]="t('progressReport.plannedStartDate')"
              [rxFormControl]="activity.get('plannedStartDate')"
              controlType="date"
            ></drr-summary-item>
          }
          @if (showPlannedCompletionDate(activity)) {
            <drr-summary-item
              [label]="t('progressReport.plannedCompletionDate')"
              [rxFormControl]="activity.get('plannedCompletionDate')"
              controlType="date"
            ></drr-summary-item>
          }
          @if (showActualStartDate(activity)) {
            <drr-summary-item
              [label]="t('progressReport.actualStartDate')"
              [rxFormControl]="activity.get('actualStartDate')"
              controlType="date"
            ></drr-summary-item>
          }
          @if (showActualCompletionDate(activity)) {
            <drr-summary-item
              [label]="t('progressReport.actualCompletionDate')"
              [rxFormControl]="activity.get('actualCompletionDate')"
              controlType="date"
            ></drr-summary-item>
          }
        </div>
        <drr-summary-item
          style="margin-left: 1rem"
          [label]="t('progressReport.keyActivityComment')"
          [rxFormControl]="activity.get('comment')"
          controlType="textarea"
        ></drr-summary-item>
      </div>

      <mat-label class="drr-label">Milestones</mat-label>
      <div
        class="summary-row"
        *ngFor="let activity of getMilestoneActivitiesArray(); let i = index"
      >
        <drr-summary-item
          [label]="t('progressReport.activity')"
          [rxFormControl]="activity.get('activity')"
          controlType="select"
          translatePrefix="activityType"
        ></drr-summary-item>
        <drr-summary-item
          [label]="t('progressReport.status')"
          [rxFormControl]="activity.get('status')"
          controlType="select"
          translatePrefix="workplanStatus"
        ></drr-summary-item>
        @if (showPlannedStartDate(activity)) {
          <drr-summary-item
            [label]="t('progressReport.plannedStartDate')"
            [rxFormControl]="activity.get('plannedStartDate')"
            controlType="date"
          ></drr-summary-item>
        }
        @if (showActualCompletionDate(activity)) {
          <drr-summary-item
            [label]="t('progressReport.actualCompletionDate')"
            [rxFormControl]="activity.get('actualCompletionDate')"
            controlType="date"
          ></drr-summary-item>
        }
      </div>

      <mat-label class="drr-label">Additional Activities</mat-label>
      <div
        style="display: flex; flex-direction: column; gap: 1rem"
        *ngFor="let activity of getAdditionalActivitiesArray(); let i = index"
      >
        <div class="summary-row">
          <drr-summary-item
            [label]="t('progressReport.activity')"
            [rxFormControl]="activity.get('activity')"
            controlType="select"
            translatePrefix="activityType"
          ></drr-summary-item>
          <drr-summary-item
            [label]="t('progressReport.status')"
            [rxFormControl]="activity.get('status')"
            controlType="select"
            translatePrefix="workplanStatus"
          ></drr-summary-item>
          @if (showPlannedStartDate(activity)) {
            <drr-summary-item
              [label]="t('progressReport.plannedStartDate')"
              [rxFormControl]="activity.get('plannedStartDate')"
              controlType="date"
            ></drr-summary-item>
          }
          @if (showPlannedCompletionDate(activity)) {
            <drr-summary-item
              [label]="t('progressReport.plannedCompletionDate')"
              [rxFormControl]="activity.get('plannedCompletionDate')"
              controlType="date"
            ></drr-summary-item>
          }
          @if (showActualStartDate(activity)) {
            <drr-summary-item
              [label]="t('progressReport.actualStartDate')"
              [rxFormControl]="activity.get('actualStartDate')"
              controlType="date"
            ></drr-summary-item>
          }
          @if (showActualCompletionDate(activity)) {
            <drr-summary-item
              [label]="t('progressReport.actualCompletionDate')"
              [rxFormControl]="activity.get('actualCompletionDate')"
              controlType="date"
            ></drr-summary-item>
          }
        </div>
        <drr-summary-item
          style="margin-left: 1rem"
          [label]="t('progressReport.keyActivityComment')"
          [rxFormControl]="activity.get('comment')"
          controlType="textarea"
        ></drr-summary-item>
      </div>

      @if (progressReportForm.get("projectType")?.value === "Stream2") {
        <mat-label class="drr-label"
          >Temporary Provincial Funding Signage</mat-label
        >
        <drr-summary-item
          [label]="t('progressReport.signageRequired')"
          [rxFormControl]="progressReportForm.get('workplan.signageRequired')"
          controlType="radio"
        ></drr-summary-item>
        @if (
          progressReportForm.get("workplan.signageRequired")?.value === true
        ) {
          <div
            class="summary-row"
            *ngFor="
              let signage of getSignageFormArray().controls;
              let i = index
            "
          >
            <drr-summary-item
              [label]="t('progressReport.beenApproved')"
              [rxFormControl]="signage.get('beenApproved')"
              controlType="radio"
            ></drr-summary-item>
            <drr-summary-item
              [label]="t('progressReport.signageType')"
              [rxFormControl]="signage.get('type')"
              controlType="select"
              translatePrefix="signageType"
            ></drr-summary-item>
            <drr-summary-item
              [label]="t('progressReport.dateInstalled')"
              [rxFormControl]="signage.get('dateInstalled')"
              controlType="date"
            ></drr-summary-item>
            <drr-summary-item
              [label]="t('progressReport.dateRemoved')"
              [rxFormControl]="signage.get('dateRemoved')"
              controlType="date"
            ></drr-summary-item>
          </div>
        }
        @if (
          progressReportForm.get("workplan.signageRequired")?.value === false
        ) {
          <drr-summary-item
            [label]="t('progressReport.signageNotRequiredComments')"
            [rxFormControl]="
              progressReportForm.get('workplan.signageNotRequiredComments')
            "
            controlType="textarea"
          ></drr-summary-item>
        }
      }

      <drr-summary-item
        [label]="t('progressReport.mediaAnnouncement')"
        [rxFormControl]="progressReportForm.get('workplan.mediaAnnouncement')"
        controlType="radio"
      ></drr-summary-item>
      @if (
        progressReportForm.get("workplan.mediaAnnouncement")?.value === true
      ) {
        <drr-summary-item
          [label]="t('progressReport.mediaAnnouncementDate')"
          [rxFormControl]="
            progressReportForm.get('workplan.mediaAnnouncementDate')
          "
          controlType="date"
        ></drr-summary-item>
        <drr-summary-item
          [label]="t('progressReport.mediaAnnouncementComment')"
          [rxFormControl]="
            progressReportForm.get('workplan.mediaAnnouncementComment')
          "
          controlType="textarea"
        ></drr-summary-item>
      }

      <drr-summary-item
        [label]="t('progressReport.outstandingIssues')"
        [rxFormControl]="progressReportForm.get('workplan.outstandingIssues')"
        controlType="radio"
      ></drr-summary-item>
      @if (
        progressReportForm.get("workplan.outstandingIssues")?.value === true
      ) {
        <drr-summary-item
          [label]="t('progressReport.outstandingIssuesComments')"
          [rxFormControl]="
            progressReportForm.get('workplan.outstandingIssuesComments')
          "
          controlType="textarea"
        ></drr-summary-item>
      }

      <drr-summary-item
        [label]="t('progressReport.fundingSourcesChanged')"
        [rxFormControl]="
          progressReportForm.get('workplan.fundingSourcesChanged')
        "
        controlType="radio"
      ></drr-summary-item>
      @if (
        progressReportForm.get("workplan.fundingSourcesChanged")?.value === true
      ) {
        <drr-summary-item
          [label]="t('progressReport.fundingSourcesChangedComment')"
          [rxFormControl]="
            progressReportForm.get('workplan.fundingSourcesChangedComment')
          "
          controlType="textarea"
        ></drr-summary-item>
      }
    </mat-card-content>
  </mat-card>
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ t("steps.progressReport.step3") }}</mat-card-title>
      <mat-card-subtitle>Step 3</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <drr-summary-item
        [label]="t('progressReport.haveEventsOccurred')"
        [rxFormControl]="
          progressReportForm.get('eventInformation.haveEventsOccurred')
        "
        controlType="radio"
      ></drr-summary-item>
      @if (
        progressReportForm.get("eventInformation.haveEventsOccurred")?.value ===
        true
      ) {
        <div
          class="summary-row"
          *ngFor="let event of getPastEventsArray().controls; let i = index"
        >
          <drr-summary-item
            [label]="t('progressReport.eventName')"
            [rxFormControl]="event.get('description')"
          ></drr-summary-item>
          <drr-summary-item
            [label]="t('progressReport.eventDate')"
            [rxFormControl]="event.get('date')"
            controlType="date"
          ></drr-summary-item>
        </div>
      }
      <drr-summary-item
        [label]="t('progressReport.haveUpcomingEvents')"
        [rxFormControl]="
          progressReportForm.get('eventInformation.haveUpcomingEvents')
        "
        controlType="radio"
      ></drr-summary-item>
      @if (
        progressReportForm.get("eventInformation.haveUpcomingEvents")?.value ===
        true
      ) {
        <div
          *ngFor="let event of getUpcomingEventsArray().controls; let i = index"
          style="display: flex; flex-direction: column; gap: 1rem"
        >
          <div class="summary-row">
            <drr-summary-item
              [label]="t('progressReport.eventName')"
              [rxFormControl]="event.get('description')"
            ></drr-summary-item>
            <drr-summary-item
              [label]="t('progressReport.eventDate')"
              [rxFormControl]="event.get('date')"
              controlType="date"
            ></drr-summary-item>
          </div>
          <mat-label class="drr-label" style="margin: 1rem 0 0 1rem">{{
            t("progressReport.eventContact")
          }}</mat-label>
          <div class="summary-row">
            <drr-summary-item
              [label]="t('progressReport.firstName')"
              [rxFormControl]="event.get('eventContact.firstName')"
            ></drr-summary-item>
            <drr-summary-item
              [label]="t('progressReport.lastName')"
              [rxFormControl]="event.get('eventContact.lastName')"
            ></drr-summary-item>
            <drr-summary-item
              [label]="t('progressReport.title')"
              [rxFormControl]="event.get('eventContact.title')"
            ></drr-summary-item>
            <drr-summary-item
              [label]="t('progressReport.department')"
              [rxFormControl]="event.get('eventContact.department')"
            ></drr-summary-item>
            <drr-summary-item
              [label]="t('progressReport.phone')"
              [rxFormControl]="event.get('eventContact.phone')"
            ></drr-summary-item>
            <drr-summary-item
              [label]="t('progressReport.email')"
              [rxFormControl]="event.get('eventContact.email')"
            ></drr-summary-item>
          </div>
          <drr-summary-item
            style="margin-left: 1rem"
            [label]="t('progressReport.provincialRepresentativeInvited')"
            [rxFormControl]="event.get('provincialRepresentativeInvited')"
            controlType="radio"
          ></drr-summary-item>
        </div>
      }
    </mat-card-content>
  </mat-card>
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ t("steps.progressReport.step4") }}</mat-card-title>
      <mat-card-subtitle>Step 4</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div
        class="summary-row"
        *ngFor="let attachment of getAttachmentsFormArray().controls"
      >
        <drr-summary-item
          [label]="t('attachments.name')"
          [rxFormControl]="attachment.get('name')"
        >
        </drr-summary-item>
        <drr-summary-item
          [label]="t('attachments.comments')"
          [rxFormControl]="attachment.get('comments')"
        >
        </drr-summary-item>
        <button
          *ngIf="isReadOnlyView"
          style="align-self: center"
          mat-button
          color="primary"
          (click)="onDownloadFile(attachment.get('id')?.value)"
        >
          Download
        </button>
      </div>
    </mat-card-content>
  </mat-card>
  <mat-card *ngIf="isReadOnlyView">
    <mat-card-header>
      <mat-card-title>{{ t("steps.progressReport.step5") }}</mat-card-title>
      <mat-card-subtitle>Step 5</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div>
        <mat-label class="drr-label">{{ t("submitter") }}</mat-label>
        <div class="summary-row">
          <drr-summary-item
            [label]="t('firstName')"
            [rxFormControl]="
              progressReportForm.get('declaration.submitter.firstName')
            "
          >
          </drr-summary-item>

          <drr-summary-item
            [label]="t('lastName')"
            [rxFormControl]="
              progressReportForm.get('declaration.submitter.lastName')
            "
          >
          </drr-summary-item>

          <drr-summary-item
            [label]="t('title')"
            [rxFormControl]="
              progressReportForm.get('declaration.submitter.title')
            "
          >
          </drr-summary-item>

          <drr-summary-item
            [label]="t('department')"
            [rxFormControl]="
              progressReportForm.get('declaration.submitter.department')
            "
          >
          </drr-summary-item>

          <drr-summary-item
            [label]="t('phone')"
            [rxFormControl]="
              progressReportForm.get('declaration.submitter.phone')
            "
            controlType="phone"
          >
          </drr-summary-item>

          <drr-summary-item
            [label]="t('email')"
            [rxFormControl]="
              progressReportForm.get('declaration.submitter.email')
            "
          >
          </drr-summary-item>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
