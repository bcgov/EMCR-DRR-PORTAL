<div class="app-stepper-container" *transloco="let t; read: 'progressReport'">
  <div class="app-stepper-header">
    <div style="flex: 1">
      <h5 style="font-size: 1.2rem; margin-bottom: 0.5rem">Progress Report</h5>
      <!-- <span> {{ t("project") }}: {{ project?.name }} ({{ project?.id }}) </span> -->
    </div>
    <div>
      <div class="header-actions">
        <button mat-stroked-button color="primary" (click)="goBack()">
          Exit Form
        </button>
        <button mat-flat-button color="primary" (click)="save()">
          <mat-icon>save</mat-icon>
          Save
        </button>
      </div>
      <!-- <div class="save-info">
          <div style="display: flex; flex-direction: row; gap: 1rem">
            <i *ngIf="autoSaveCountdown <= 30 && autoSaveCountdown > 0"
              >Saving in {{ autoSaveCountdown }}
              {{ autoSaveCountdown === 1 ? "second" : "seconds" }}...
            </i>
            <i
              *ngIf="
                lastSavedAt && (autoSaveCountdown === 0 || autoSaveCountdown > 30)
              "
              >Saved at {{ lastSavedAt | date : "mediumTime" }}</i
            >
          </div>
        </div> -->
    </div>
  </div>
  <mat-stepper
    class="app-stepper"
    [linear]="false"
    labelPosition="bottom"
    (selectionChange)="stepperSelectionChange($event)"
    [orientation]="stepperOrientation"
    #stepper
  >
    <mat-step label="Instructions">
      <div>
        <p>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras a
          suscipit lectus. Sed molestie dolor nec tortor hendrerit consequat. In
          at mauris vel lorem molestie rutrum. Curabitur dictum ligula id
          fermentum ultrices. In vel tortor volutpat, ultrices ipsum vel,
          lacinia eros. Curabitur quis lectus et ipsum sagittis semper et
          commodo turpis. Curabitur viverra felis vel consectetur fringilla.
          Nunc eu egestas magna, eget tincidunt ex. Integer accumsan, velit eget
          faucibus ornare, enim risus accumsan dui, congue luctus dui eros sed
          nunc. Vestibulum et blandit libero. Fusce nec mauris interdum, cursus
          nibh ut, tristique leo. Nullam rhoncus, lectus ac euismod semper,
          massa lacus elementum ipsum, vel mollis lacus sem in ante. Mauris a
          dignissim nunc. Duis mollis facilisis odio, nec interdum enim
          malesuada sed. Fusce congue tristique fermentum.
        </p>
        <p>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras a
          suscipit lectus. Sed molestie dolor nec tortor hendrerit consequat. In
          at mauris vel lorem molestie rutrum. Curabitur dictum ligula id
          fermentum ultrices. In vel tortor volutpat, ultrices ipsum vel,
          lacinia eros.
        </p>
      </div>
      <div class="drr-stepper-action">
        <button
          id="next1"
          mat-flat-button
          color="primary"
          matStepperNext
          type="button"
        >
          Next
        </button>
      </div>
    </mat-step>
    <mat-step [label]="t('projectWorkplan')">
      <div>
        <div
          *ngFor="
            let preDefinedActivity of getPreDefinedActivitiesArray();
            let i = index
          "
          style="margin-top: 1rem"
        >
          <mat-card>
            <mat-card-header>
              <mat-card-title>
                {{
                  "activityType." + preDefinedActivity.get("activity")?.value
                    | transloco
                }}
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="progress-group">
                <drr-radio-button
                  class="drr-single-input"
                  label="Status"
                  [options]="necessaryActivityOptions"
                  [rxFormControl]="preDefinedActivity.get('status')"
                ></drr-radio-button>

                <div
                  style="
                    display: flex;
                    flex-direction: column;
                    justify-content: space-between;
                    gap: 1rem;
                  "
                >
                  @if (showPlannedStartDate(preDefinedActivity)) {
                  <drr-datepicker
                    class="drr-single-input"
                    [label]="t('plannedStartDate')"
                    [rxFormControl]="preDefinedActivity.get('plannedStartDate')"
                    [max]="
                      preDefinedActivity.get('plannedCompletionDate')?.value
                    "
                    [maxErrorLabel]="t('minStartDateError')"
                  ></drr-datepicker>
                  } @if (showPlannedEndDate(preDefinedActivity)) {
                  <drr-datepicker
                    class="drr-single-input"
                    [label]="t('plannedEndDate')"
                    [rxFormControl]="
                      preDefinedActivity.get('plannedCompletionDate')
                    "
                    [min]="preDefinedActivity.get('plannedStartDate')?.value"
                    [minErrorLabel]="t('minEndDateError')"
                  ></drr-datepicker>
                  } @if (showActualStartDate(preDefinedActivity)) {
                  <drr-datepicker
                    class="drr-single-input"
                    [label]="t('actualStartDate')"
                    [rxFormControl]="preDefinedActivity.get('actualStartDate')"
                    [max]="
                      preDefinedActivity.get('actualCompletionDate')?.value
                    "
                    [maxErrorLabel]="t('minStartDateError')"
                  ></drr-datepicker>
                  } @if (showActualEndDate(preDefinedActivity)) {
                  <drr-datepicker
                    class="drr-single-input"
                    [label]="t('actualEndDate')"
                    [rxFormControl]="
                      preDefinedActivity.get('actualCompletionDate')
                    "
                    [min]="preDefinedActivity.get('actualStartDate')?.value"
                    [minErrorLabel]="t('minEndDateError')"
                  ></drr-datepicker>
                  }
                </div>
              </div>
              <drr-textarea
                [label]="t('keyActivityComment')"
                [rxFormControl]="preDefinedActivity.get('comment')"
                [maxlength]="250"
              ></drr-textarea>
            </mat-card-content>
          </mat-card>
        </div>

        <h5 style="margin-top: 2rem">Additional Activities</h5>

        <div
          *ngFor="
            let additionalActivity of getAdditionalActivitiesArray();
            let i = index
          "
          style="margin-top: 1rem"
        >
          <mat-card>
            <mat-card-header>
              <mat-card-title>
                <mat-card-title-group>
                  <mat-card-title>
                    Additional Activity {{ i + 1 }}
                  </mat-card-title>
                  @if (isAdditionalActivityMandatory(additionalActivity)) {
                  <mat-card-subtitle>
                    {{
                      "activityType." +
                        additionalActivity.get("activity")?.value | transloco
                    }}
                  </mat-card-subtitle>
                  }
                </mat-card-title-group>
              </mat-card-title>
            </mat-card-header>
            <mat-card-content style="display: flex; flex-direction: column">
              @if (!isAdditionalActivityMandatory(additionalActivity)) {
              <drr-select
                style="margin-top: 0.5rem"
                class="drr-single-input"
                label="Activity"
                [rxFormControl]="additionalActivity.get('activity')"
                [options]="activityTypeOptions"
              >
              </drr-select>
              }
              <div class="progress-group">
                <drr-radio-button
                  class="drr-single-input"
                  label="Status"
                  [options]="getAdditionalActivityOptions(additionalActivity)"
                  [rxFormControl]="additionalActivity.get('status')"
                ></drr-radio-button>

                <div
                  style="
                    display: flex;
                    flex-direction: column;
                    justify-content: space-between;
                    gap: 1rem;
                  "
                >
                  @if (showPlannedStartDate(additionalActivity)) {
                  <drr-datepicker
                    class="drr-single-input"
                    [label]="t('plannedStartDate')"
                    [rxFormControl]="additionalActivity.get('plannedStartDate')"
                    [max]="
                      additionalActivity.get('plannedCompletionDate')?.value
                    "
                    [maxErrorLabel]="t('minStartDateError')"
                  ></drr-datepicker>
                  } @if (showPlannedEndDate(additionalActivity)) {
                  <drr-datepicker
                    class="drr-single-input"
                    [label]="t('plannedEndDate')"
                    [rxFormControl]="
                      additionalActivity.get('plannedCompletionDate')
                    "
                    [min]="additionalActivity.get('plannedStartDate')?.value"
                    [minErrorLabel]="t('minEndDateError')"
                  ></drr-datepicker>
                  } @if (showActualStartDate(additionalActivity)) {
                  <drr-datepicker
                    class="drr-single-input"
                    [label]="t('actualStartDate')"
                    [rxFormControl]="additionalActivity.get('actualStartDate')"
                    [max]="
                      additionalActivity.get('actualCompletionDate')?.value
                    "
                    [maxErrorLabel]="t('minStartDateError')"
                  ></drr-datepicker>
                  } @if (showActualEndDate(additionalActivity)) {
                  <drr-datepicker
                    class="drr-single-input"
                    [label]="t('actualEndDate')"
                    [rxFormControl]="
                      additionalActivity.get('actualCompletionDate')
                    "
                    [min]="additionalActivity.get('actualStartDate')?.value"
                    [minErrorLabel]="t('minEndDateError')"
                  ></drr-datepicker>
                  }
                </div>
              </div>
              <drr-textarea
                [label]="
                  t(
                    isAdditionalActivityMandatory(additionalActivity)
                      ? 'keyActivityComment'
                      : 'additionalActivityComment'
                  )
                "
                [rxFormControl]="additionalActivity.get('comment')"
                [maxlength]="250"
              ></drr-textarea>
            </mat-card-content>
            @if (!isAdditionalActivityMandatory(additionalActivity)) {
            <mat-card-actions align="end">
              <button
                mat-raised-button
                color="warn"
                (click)="removeAdditionalActivity(i)"
              >
                Remove
              </button>
            </mat-card-actions>
            }
          </mat-card>
        </div>
        <button
          mat-raised-button
          color="primary"
          style="margin-top: 1rem"
          (click)="addAdditionalActivity()"
        >
          Add Additional Activity
        </button>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
          "
        >
          <div class="workplan-item">
            <mat-label class="drr-label">
              Percentage of Project Complete as of report date
            </mat-label>
            <drr-input
              class="drr-single-input"
              label="Percentage"
              [rxFormControl]="workplanForm?.get('projectCompletionPercentage')"
            ></drr-input>
          </div>
          <div class="workplan-item">
            <mat-label class="drr-label"> Media Announcements</mat-label>
            <drr-radio-button
              class="drr-single-input"
              label="Please select below"
              [options]="yesNoRadioOptions"
              [rxFormControl]="workplanForm?.get('mediaAnnouncement')"
            ></drr-radio-button>
            @if
            (showMandatoryControl(workplanForm?.get('mediaAnnouncementDate'))) {
            <drr-datepicker
              class="drr-single-input"
              label="Date of Announcement"
              [rxFormControl]="workplanForm?.get('mediaAnnouncementDate')"
            ></drr-datepicker>
            } @if
            (showMandatoryControl(workplanForm?.get('mediaAnnouncementComment')))
            {
            <drr-textarea
              label="Comments"
              [rxFormControl]="workplanForm?.get('mediaAnnouncementComment')"
              [maxlength]="2000"
            ></drr-textarea>
            }
          </div>
          <div class="workplan-item">
            <mat-label class="drr-label"> Works Completed </mat-label>
            <drr-textarea
              label="Please provide a bulleted list of works completed since the last project report"
              [rxFormControl]="workplanForm?.get('worksCompleted')"
            ></drr-textarea>
          </div>
          <div class="workplan-item">
            <mat-label class="drr-label"> Outstanding Issues </mat-label>
            <drr-radio-button
              class="drr-single-input"
              [label]="t('outstandingIssues')"
              [rxFormControl]="workplanForm?.get('outstandingIssues')"
              [options]="yesNoRadioOptions"
            ></drr-radio-button>
            @if
            (showMandatoryControl(workplanForm?.get('outstandingIssuesComment')))
            {
            <drr-textarea
              [label]="t('outstandingIssuesComment')"
              [rxFormControl]="workplanForm?.get('outstandingIssuesComment')"
              [maxlength]="2000"
            ></drr-textarea>
            }
          </div>
          <div class="workplan-item">
            <mat-label class="drr-label">
              Changes to Funding Srouces
            </mat-label>
            <drr-radio-button
              class="drr-single-input"
              label="Have there been changes to other funding sources in the last quarter?"
              [rxFormControl]="workplanForm?.get('fundingSourcesChanged')"
              [options]="yesNoRadioOptions"
            ></drr-radio-button>
            @if
            (showMandatoryControl(workplanForm?.get('fundingSourcesChangedComment')))
            {
            <drr-textarea
              label="Please provide details on any changes to other funding sources"
              [rxFormControl]="
                workplanForm?.get('fundingSourcesChangedComment')
              "
              [maxlength]="2000"
            ></drr-textarea>
            }
          </div>
        </div>
      </div>
      <div class="drr-stepper-actions">
        <button mat-stroked-button color="primary" matStepperPrevious>
          Back
        </button>
        <button
          id="next2"
          mat-flat-button
          color="primary"
          matStepperNext
          type="button"
        >
          Next
        </button>
      </div></mat-step
    >
    <mat-step [label]="t('eventInformation')">
      <div style="display: flex; flex-direction: column; gap: 1rem">
        <mat-label class="drr-label"> Ground Breaking Event </mat-label>
        <div class="progress-group">
          <drr-radio-button
            class="drr-single-input"
            label="Ground breaking event details"
            [options]="eventProgressOptions"
            [rxFormControl]="eventForm?.get('groundBreaking')"
          ></drr-radio-button>
          <drr-datepicker
            class="drr-single-input"
            label="Date"
            [rxFormControl]="eventForm?.get('groundBreakingDate')"
          ></drr-datepicker>
        </div>
        <mat-label class="drr-label"> Ribbon Cutting </mat-label>
        <div class="progress-group">
          <drr-radio-button
            class="drr-single-input"
            label="Ribbon cutting event details"
            [options]="eventProgressOptions"
            [rxFormControl]="eventForm?.get('ribbonCutting')"
          ></drr-radio-button>
          <drr-datepicker
            class="drr-single-input"
            label="Date"
            [rxFormControl]="eventForm?.get('ribbonCuttingDate')"
          ></drr-datepicker>
        </div>
        <mat-label class="drr-label"> Community Engagement </mat-label>
        <div class="progress-group">
          <drr-radio-button
            class="drr-single-input"
            label="Community engagement event details"
            [options]="eventProgressOptions"
            [rxFormControl]="eventForm?.get('communityEngagement')"
          ></drr-radio-button>
          <drr-datepicker
            class="drr-single-input"
            label="Date"
            [rxFormControl]="eventForm?.get('communityEngagementDate')"
          ></drr-datepicker>
        </div>

        <mat-label class="drr-label">
          Provincial Representative Request
        </mat-label>
        <drr-select
          class="drr-single-input"
          label="Is the community requesting a provincial representative be present for the event?"
          [rxFormControl]="eventForm?.get('provincialRepresentativeRequest')"
          [options]="yesNoSelectOptions"
        ></drr-select>
        <drr-textarea
          label="Please provide details on the request"
          [rxFormControl]="
            eventForm?.get('provincialRepresentativeRequestComment')
          "
        ></drr-textarea>
      </div>
      <div class="drr-stepper-actions">
        <button mat-stroked-button color="primary" matStepperPrevious>
          Back
        </button>
        <button
          id="next2"
          mat-flat-button
          color="primary"
          matStepperNext
          type="button"
        >
          Next
        </button>
      </div>
    </mat-step>
    <mat-step label="Attachments">
      <div class="drr-stepper-actions">
        <button mat-stroked-button color="primary" matStepperPrevious>
          Back
        </button>
        <button
          id="next2"
          mat-flat-button
          color="primary"
          matStepperNext
          type="button"
        >
          Next
        </button>
      </div></mat-step
    >
    <mat-step label="Review & Declarations">
      <div class="drr-stepper-actions">
        <button mat-stroked-button color="primary" matStepperPrevious>
          Back
        </button>
        <button
          id="submit"
          mat-flat-button
          color="primary"
          type="button"
          (click)="submit()"
        >
          Submit
        </button>
      </div></mat-step
    >
  </mat-stepper>
</div>
