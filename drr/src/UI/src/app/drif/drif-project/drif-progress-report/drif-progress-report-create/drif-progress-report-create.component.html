<mat-card
  class="app-stepper-container"
  *transloco="let t; read: 'progressReport'"
>
  <mat-card-header class="app-stepper-header">
    <mat-card-title-group>
      <mat-card-title>
        <h2>{{ reportName }}</h2>
      </mat-card-title>
      <div>
        <div class="header-actions">
          <button mat-stroked-button color="primary" (click)="goBack()">
            Exit Form
          </button>
          @if (stepper.selectedIndex !== 0) {
            <button mat-flat-button color="primary" (click)="save()">
              <mat-icon>save</mat-icon>
              Save
            </button>
          }
        </div>
        <div class="save-info">
          <div style="display: flex; flex-direction: row; gap: 1rem">
            <i *ngIf="autoSaveCountdown <= 30 && autoSaveCountdown > 0"
              >Saving in {{ autoSaveCountdown }}
              {{ autoSaveCountdown === 1 ? "second" : "seconds" }}...
            </i>
            <i
              *ngIf="
                lastSavedAt &&
                (autoSaveCountdown === 0 || autoSaveCountdown > 30)
              "
              >Saved at {{ lastSavedAt | date: "mediumTime" }}</i
            >
          </div>
        </div>
      </div>
    </mat-card-title-group>
  </mat-card-header>
  <mat-card-content>
    <mat-stepper
      class="app-stepper"
      [linear]="false"
      labelPosition="bottom"
      (selectionChange)="stepperSelectionChange($event)"
      [orientation]="stepperOrientation"
      #stepper
    >
      <mat-step label="Instructions">
        <mat-card>
          <mat-card-header>
            <h3>Instructions</h3>
          </mat-card-header>
          <mat-card-content>
            <div>
              <p>
                This form captures the overall progress on your project, as well
                as information about any events you may have planned.
              </p>
              <p>
                You will report your status against the specific activities you
                listed in the Project Plan on your full proposal. You will also
                be able to add new activities if needed.
              </p>
              <p>
                If this is your first time completing a progress report for this
                project, most of the values will be blank. Otherwise, many of
                the values will be copied over from your previous report to help
                you complete it more quickly.
              </p>
              <p>
                Please be sure to review all information thoroughly and to
                update it where needed.
              </p>
            </div>
          </mat-card-content>
        </mat-card>
        <div class="drr-stepper-action">
          <button
            id="next1"
            mat-flat-button
            color="primary"
            matStepperNext
            type="button"
          >
            Next
          </button>
        </div>
      </mat-step>
      <mat-step
        [label]="t('projectWorkplan')"
        [stepControl]="workplanForm"
        [errorMessage]="'stepError' | transloco"
      >
        <mat-card>
          <mat-card-header>
            <h3>{{ t("projectWorkplan") }}</h3>
          </mat-card-header>
          <mat-card-content>
            <div class="drr-step-container">
              <div>
                <div style="width: 50rem">
                  <h4>Project Progress</h4>
                  <drr-select
                    [label]="t('projectProgress')"
                    [rxFormControl]="workplanForm.get('projectProgress')"
                    [options]="projectProgressOptions"
                  >
                  </drr-select>
                </div>

                @if (isProjectDelayed()) {
                  <div style="display: flex; gap: 1rem">
                    <drr-select
                      style="width: 50rem"
                      [label]="t('delayReason')"
                      [rxFormControl]="workplanForm.get('delayReason')"
                      [options]="delayReasonOptions"
                    >
                    </drr-select>
                    @if (isOtherDelayReasonSelected()) {
                      <drr-input
                        class="drr-single-input"
                        [label]="t('otherDelayReason')"
                        [rxFormControl]="workplanForm.get('otherDelayReason')"
                        [maxlength]="50"
                      ></drr-input>
                    }
                  </div>

                  <drr-textarea
                    [label]="t('behindScheduleMitigatingComments')"
                    [rxFormControl]="
                      workplanForm.get('behindScheduleMitigatingComments')
                    "
                    [maxlength]="2000"
                  ></drr-textarea>
                }
                @if (isProjectAhead()) {
                  <drr-textarea
                    [label]="t('aheadOfScheduleComments')"
                    [rxFormControl]="
                      workplanForm.get('aheadOfScheduleComments')
                    "
                    [maxlength]="2000"
                  ></drr-textarea>
                }
              </div>

              <div class="workplan-item">
                <h4>{{ t("projectCompletionPercentage") }}</h4>
                <drr-numeric-input
                  style="align-self: flex-start"
                  label="Percentage"
                  [rxFormControl]="
                    workplanForm.get('projectCompletionPercentage')
                  "
                  numericType="percentage"
                ></drr-numeric-input>
              </div>

              @if (isStructuralProject()) {
                <div class="workplan-item">
                  <h4>
                    {{ t("constructionCompletionPercentage") }}
                  </h4>
                  <drr-numeric-input
                    style="align-self: flex-start"
                    label="Percentage"
                    [rxFormControl]="
                      workplanForm.get('constructionCompletionPercentage')
                    "
                    numericType="percentage"
                  ></drr-numeric-input>
                </div>
              }

              <div>
                <h4>Key Activities</h4>
                <div
                  *ngFor="
                    let preDefinedActivity of getPreDefinedActivitiesArray();
                    let i = index
                  "
                  style="margin-top: 1rem"
                >
                  <mat-card>
                    <mat-card-header>
                      <mat-card-title>
                        {{
                          "activityType." +
                            preDefinedActivity.get("activity")?.value
                            | transloco
                        }}
                      </mat-card-title>
                    </mat-card-header>
                    <mat-card-content>
                      <div class="progress-group">
                        <drr-radio-button
                          class="drr-single-input"
                          label="Status"
                          [options]="necessaryActivityStatusOptions"
                          [rxFormControl]="preDefinedActivity.get('status')"
                        ></drr-radio-button>

                        <div
                          style="
                            display: flex;
                            flex-direction: column;
                            justify-content: space-between;
                            gap: 1rem;
                          "
                        >
                          @if (showPlannedStartDate(preDefinedActivity)) {
                            <drr-datepicker
                              class="drr-single-input"
                              [label]="t('plannedStartDate')"
                              [rxFormControl]="
                                preDefinedActivity.get('plannedStartDate')
                              "
                              [max]="
                                preDefinedActivity.get('plannedCompletionDate')
                                  ?.value
                              "
                              [maxErrorLabel]="t('minStartDateError')"
                            ></drr-datepicker>
                          }

                          @if (showActualStartDate(preDefinedActivity)) {
                            <drr-datepicker
                              class="drr-single-input"
                              [label]="t('actualStartDate')"
                              [rxFormControl]="
                                preDefinedActivity.get('actualStartDate')
                              "
                              [max]="
                                preDefinedActivity.get('actualCompletionDate')
                                  ?.value
                              "
                              [maxErrorLabel]="t('minStartDateError')"
                            ></drr-datepicker>
                          }

                          @if (showPlannedCompletionDate(preDefinedActivity)) {
                            <drr-datepicker
                              class="drr-single-input"
                              [label]="t('plannedCompletionDate')"
                              [rxFormControl]="
                                preDefinedActivity.get('plannedCompletionDate')
                              "
                              [min]="
                                preDefinedActivity.get('plannedStartDate')
                                  ?.value
                              "
                              [minErrorLabel]="t('minEndDateError')"
                            ></drr-datepicker>
                          }

                          @if (showActualCompletionDate(preDefinedActivity)) {
                            <drr-datepicker
                              class="drr-single-input"
                              [label]="t('actualCompletionDate')"
                              [rxFormControl]="
                                preDefinedActivity.get('actualCompletionDate')
                              "
                              [min]="
                                preDefinedActivity.get('actualStartDate')?.value
                              "
                              [minErrorLabel]="t('minEndDateError')"
                            ></drr-datepicker>
                          }
                        </div>
                      </div>
                      <drr-textarea
                        [label]="t('keyActivityComment')"
                        [rxFormControl]="preDefinedActivity.get('comment')"
                        [maxlength]="250"
                      ></drr-textarea>
                    </mat-card-content>
                  </mat-card>
                </div>
              </div>

              @if (getMilestoneActivitiesArray().length > 0) {
                <div>
                  <h3 style="margin-top: 2rem">Milestones</h3>

                  <div
                    *ngFor="
                      let milestoneActivity of getMilestoneActivitiesArray();
                      let i = index
                    "
                    style="margin-top: 1rem"
                  >
                    <mat-card>
                      <mat-card-header>
                        <mat-card-title>
                          {{
                            "activityType." +
                              milestoneActivity.get("activity")?.value
                              | transloco
                          }}
                        </mat-card-title>
                      </mat-card-header>
                      <mat-card-content>
                        <div class="progress-group">
                          <drr-radio-button
                            class="drr-single-input"
                            label="Status"
                            [options]="milestoneStatusOptions"
                            [rxFormControl]="milestoneActivity.get('status')"
                          ></drr-radio-button>

                          <div
                            style="
                              display: flex;
                              flex-direction: column;
                              justify-content: space-between;
                              gap: 1rem;
                            "
                          >
                            @if (showPlannedStartDate(milestoneActivity)) {
                              <drr-datepicker
                                class="drr-single-input"
                                [label]="t('plannedAwardDate')"
                                [rxFormControl]="
                                  milestoneActivity.get('plannedStartDate')
                                "
                                [max]="
                                  milestoneActivity.get('plannedCompletionDate')
                                    ?.value
                                "
                                [maxErrorLabel]="t('minStartDateError')"
                              ></drr-datepicker>
                            }
                            @if (showActualStartDate(milestoneActivity)) {
                              <drr-datepicker
                                class="drr-single-input"
                                [label]="t('actualAwardDate')"
                                [rxFormControl]="
                                  milestoneActivity.get('actualStartDate')
                                "
                                [max]="
                                  milestoneActivity.get('actualCompletionDate')
                                    ?.value
                                "
                                [maxErrorLabel]="t('minStartDateError')"
                              ></drr-datepicker>
                            }
                          </div>
                        </div>
                      </mat-card-content>
                    </mat-card>
                  </div>
                </div>
              }

              <div>
                <h3 style="margin-top: 2rem">Additional Activities</h3>

                <div
                  *ngFor="
                    let additionalActivity of getAdditionalActivitiesArray();
                    let i = index
                  "
                  style="margin-top: 1rem"
                >
                  <mat-card>
                    <mat-card-header>
                      <mat-card-title>
                        <mat-card-title-group>
                          <mat-card-title>
                            Additional Activity {{ i + 1 }}
                          </mat-card-title>
                          @if (
                            isAdditionalActivityMandatory(additionalActivity)
                          ) {
                            <mat-card-subtitle>
                              {{
                                "activityType." +
                                  additionalActivity.get("activity")?.value
                                  | transloco
                              }}
                            </mat-card-subtitle>
                          }
                        </mat-card-title-group>
                      </mat-card-title>
                    </mat-card-header>
                    <mat-card-content
                      style="display: flex; flex-direction: column"
                    >
                      @if (!isAdditionalActivityMandatory(additionalActivity)) {
                        <drr-select
                          style="margin-top: 0.5rem"
                          class="drr-single-input"
                          label="Activity"
                          [rxFormControl]="additionalActivity.get('activity')"
                          [options]="
                            getAvailableOptionsForActivity(
                              additionalActivity.get('activity')?.value
                            )
                          "
                        >
                        </drr-select>
                      }
                      <div class="progress-group">
                        <drr-radio-button
                          class="drr-single-input"
                          label="Status"
                          [options]="
                            getAdditionalActivityOptions(additionalActivity)
                          "
                          [rxFormControl]="additionalActivity.get('status')"
                        ></drr-radio-button>

                        <div
                          style="
                            display: flex;
                            flex-direction: column;
                            justify-content: space-between;
                            gap: 1rem;
                          "
                        >
                          @if (showPlannedStartDate(additionalActivity)) {
                            <drr-datepicker
                              class="drr-single-input"
                              [label]="t('plannedStartDate')"
                              [rxFormControl]="
                                additionalActivity.get('plannedStartDate')
                              "
                              [max]="
                                additionalActivity.get('plannedCompletionDate')
                                  ?.value
                              "
                              [maxErrorLabel]="t('minStartDateError')"
                            ></drr-datepicker>
                          }
                          @if (showActualStartDate(additionalActivity)) {
                            <drr-datepicker
                              class="drr-single-input"
                              [label]="t('actualStartDate')"
                              [rxFormControl]="
                                additionalActivity.get('actualStartDate')
                              "
                              [max]="
                                additionalActivity.get('actualCompletionDate')
                                  ?.value
                              "
                              [maxErrorLabel]="t('minStartDateError')"
                            ></drr-datepicker>
                          }
                          @if (showPlannedCompletionDate(additionalActivity)) {
                            <drr-datepicker
                              class="drr-single-input"
                              [label]="t('plannedCompletionDate')"
                              [rxFormControl]="
                                additionalActivity.get('plannedCompletionDate')
                              "
                              [min]="
                                additionalActivity.get('plannedStartDate')
                                  ?.value
                              "
                              [minErrorLabel]="t('minEndDateError')"
                            ></drr-datepicker>
                          }
                          @if (showActualCompletionDate(additionalActivity)) {
                            <drr-datepicker
                              class="drr-single-input"
                              [label]="t('actualCompletionDate')"
                              [rxFormControl]="
                                additionalActivity.get('actualCompletionDate')
                              "
                              [min]="
                                additionalActivity.get('actualStartDate')?.value
                              "
                              [minErrorLabel]="t('minEndDateError')"
                            ></drr-datepicker>
                          }
                        </div>
                      </div>
                      <drr-textarea
                        [label]="
                          t(
                            isAdditionalActivityMandatory(additionalActivity)
                              ? 'keyActivityComment'
                              : 'additionalActivityComment'
                          )
                        "
                        [rxFormControl]="additionalActivity.get('comment')"
                        [maxlength]="250"
                      ></drr-textarea>
                    </mat-card-content>
                    @if (!isAdditionalActivityMandatory(additionalActivity)) {
                      <mat-card-actions align="end">
                        <button
                          mat-raised-button
                          color="warn"
                          (click)="
                            removeAdditionalActivity(
                              additionalActivity.get('id')?.value
                            )
                          "
                        >
                          Remove
                        </button>
                      </mat-card-actions>
                    }
                  </mat-card>
                </div>
                @if (hasAvailableOptionsForActivity()) {
                  <button
                    mat-raised-button
                    color="primary"
                    style="margin-top: 1rem"
                    (click)="addAdditionalActivity()"
                  >
                    Add Additional Activity
                  </button>
                }
              </div>

              @if (isStructuralProject()) {
                <div>
                  <h3 style="margin-top: 2rem">
                    Temporary Provincial Funding Signage
                  </h3>

                  <drr-radio-button
                    class="drr-single-input"
                    [label]="t('signageRequired')"
                    [options]="yesNoRadioOptions"
                    [rxFormControl]="workplanForm.get('signageRequired')"
                  ></drr-radio-button>

                  @if (workplanForm.get("signageRequired")?.value === true) {
                    <div
                      *ngFor="
                        let signage of getSignageFormArray().controls;
                        let i = index
                      "
                      style="margin-top: 1rem"
                    >
                      <mat-card>
                        <mat-card-header>
                          <mat-card-title-group>
                            <mat-card-subtitle>
                              Signage {{ i + 1 }}
                            </mat-card-subtitle>
                          </mat-card-title-group>
                        </mat-card-header>
                        <mat-card-content>
                          <div style="display: flex; gap: 1rem">
                            <drr-radio-button
                              class="drr-single-input"
                              [label]="t('beenApproved')"
                              [options]="yesNoRadioOptions"
                              [rxFormControl]="signage.get('beenApproved')"
                            ></drr-radio-button>
                            <drr-select
                              class="drr-single-input"
                              [label]="t('signageType')"
                              [rxFormControl]="signage.get('type')"
                              [options]="signageTypeOptions"
                            >
                            </drr-select>
                            <drr-datepicker
                              class="drr-single-input"
                              [label]="t('dateInstalled')"
                              [rxFormControl]="signage.get('dateInstalled')"
                              [max]="signage.get('dateRemoved')?.value"
                              [maxErrorLabel]="t('maxDateInstalledError')"
                            ></drr-datepicker>
                            <drr-datepicker
                              class="drr-single-input"
                              [label]="t('dateRemoved')"
                              [rxFormControl]="signage.get('dateRemoved')"
                              [min]="signage.get('dateInstalled')?.value"
                              [minErrorLabel]="t('minDateRemovedError')"
                            ></drr-datepicker>
                          </div>
                        </mat-card-content>
                        @if (getSignageFormArray().controls.length > 1) {
                          <mat-card-actions align="end">
                            <button
                              mat-raised-button
                              color="warn"
                              (click)="removeSignage(signage.get('id')?.value)"
                            >
                              Remove
                            </button>
                          </mat-card-actions>
                        }
                      </mat-card>
                    </div>
                    <button
                      style="margin-top: 1rem; align-self: flex-start"
                      mat-raised-button
                      color="primary"
                      (click)="addSignage()"
                    >
                      Add Signage
                    </button>
                  }
                  @if (workplanForm.get("signageRequired")?.value === false) {
                    <drr-input
                      style="width: 50rem"
                      [label]="t('signageNotRequiredComments')"
                      [rxFormControl]="
                        workplanForm.get('signageNotRequiredComments')
                      "
                      [maxlength]="50"
                    ></drr-input>
                  }
                </div>
              }

              <div
                style="
                  display: flex;
                  flex-direction: column;
                  gap: 1rem;
                  margin-top: 2rem;
                "
              >
                <div class="workplan-item">
                  <h4>
                    {{ t("mediaAnnouncement") }}
                  </h4>
                  <drr-radio-button
                    class="drr-single-input"
                    label="Please select below"
                    [options]="yesNoRadioOptions"
                    [rxFormControl]="workplanForm.get('mediaAnnouncement')"
                  ></drr-radio-button>
                  @if (workplanForm.get("mediaAnnouncement")?.value === true) {
                    <drr-datepicker
                      class="drr-single-input"
                      label="Date of Announcement"
                      [rxFormControl]="
                        workplanForm.get('mediaAnnouncementDate')
                      "
                    ></drr-datepicker>
                    <drr-textarea
                      label="Comments"
                      [rxFormControl]="
                        workplanForm.get('mediaAnnouncementComment')
                      "
                      [maxlength]="2000"
                    ></drr-textarea>
                  }
                </div>
              </div>
              <div class="workplan-item">
                <h4>Outstanding Issues</h4>
                <drr-radio-button
                  class="drr-single-input"
                  [label]="t('outstandingIssues')"
                  [rxFormControl]="workplanForm.get('outstandingIssues')"
                  [options]="yesNoRadioOptions"
                ></drr-radio-button>
                @if (workplanForm.get("outstandingIssues")?.value === true) {
                  <drr-textarea
                    [label]="t('outstandingIssuesComments')"
                    [rxFormControl]="
                      workplanForm.get('outstandingIssuesComments')
                    "
                    [maxlength]="2000"
                  ></drr-textarea>
                }
              </div>
              <div class="workplan-item">
                <h4>Changes to Funding Sources</h4>
                <drr-radio-button
                  class="drr-single-input"
                  [label]="t('fundingSourcesChanged')"
                  [rxFormControl]="workplanForm.get('fundingSourcesChanged')"
                  [options]="yesNoRadioOptions"
                ></drr-radio-button>
                @if (
                  workplanForm.get("fundingSourcesChanged")?.value === true
                ) {
                  <drr-textarea
                    [label]="t('fundingSourcesChangedComment')"
                    [rxFormControl]="
                      workplanForm.get('fundingSourcesChangedComment')
                    "
                    [maxlength]="2000"
                  ></drr-textarea>
                }
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <div class="drr-stepper-actions">
          <button mat-stroked-button color="primary" matStepperPrevious>
            Back
          </button>
          <button
            id="next2"
            mat-flat-button
            color="primary"
            matStepperNext
            type="button"
          >
            Next
          </button>
        </div></mat-step
      >
      <mat-step
        [label]="t('eventInformation')"
        [stepControl]="eventInformationForm"
        [errorMessage]="'stepError' | transloco"
      >
        <mat-card>
          <mat-card-header>
            <h3>{{ t("eventInformation") }}</h3>
          </mat-card-header>

          <mat-card-content>
            <div class="drr-step-container">
              <div>
                <h4>Past Project Events</h4>
                <drr-radio-button
                  class="drr-single-input"
                  [label]="t('eventsOccurredSinceLastReport')"
                  [options]="yesNoRadioOptions"
                  [rxFormControl]="
                    eventInformationForm.get('eventsOccurredSinceLastReport')
                  "
                ></drr-radio-button>
                @if (
                  eventInformationForm.get("eventsOccurredSinceLastReport")
                    ?.value === true
                ) {
                  <div
                    *ngFor="
                      let pastEvent of getPastEventsArray().controls;
                      let i = index
                    "
                  >
                    <mat-card>
                      <mat-card-header>
                        <mat-card-title-group>
                          <mat-card-subtitle>
                            Past Event {{ i + 1 }}
                          </mat-card-subtitle>
                        </mat-card-title-group></mat-card-header
                      >
                      <mat-card-content style="display: flex; gap: 1rem">
                        <drr-input
                          #pastEventNameInput
                          class="drr-single-input"
                          [label]="t('eventName')"
                          [rxFormControl]="pastEvent.get('details')"
                          [maxlength]="50"
                        ></drr-input>
                        <drr-datepicker
                          class="drr-single-input"
                          [label]="t('eventDate')"
                          [rxFormControl]="pastEvent.get('date')"
                        ></drr-datepicker>
                      </mat-card-content>
                      @if (getPastEventsArray().controls.length > 1) {
                        <mat-card-actions align="end">
                          <button
                            mat-raised-button
                            color="warn"
                            (click)="removePastEvent(i)"
                          >
                            Remove
                          </button>
                        </mat-card-actions>
                      }
                    </mat-card>
                  </div>
                  <button
                    style="margin-top: 1rem; align-self: flex-start"
                    mat-raised-button
                    color="primary"
                    (click)="addPastEvent()"
                  >
                    Add Past Event
                  </button>
                }
              </div>

              <div>
                <h4>Upcoming Project Events</h4>
                <drr-radio-button
                  class="drr-single-input"
                  [label]="t('anyUpcomingEvents')"
                  [options]="yesNoRadioOptions"
                  [rxFormControl]="
                    eventInformationForm.get('anyUpcomingEvents')
                  "
                ></drr-radio-button>
                @if (
                  eventInformationForm.get("anyUpcomingEvents")?.value === true
                ) {
                  <div
                    *ngFor="
                      let upcomingEvent of getUpcomingEventsArray().controls;
                      let i = index
                    "
                  >
                    <mat-card>
                      <mat-card-header>
                        <mat-card-title-group>
                          <mat-card-subtitle>
                            Future Event {{ i + 1 }}
                          </mat-card-subtitle>
                        </mat-card-title-group></mat-card-header
                      >
                      <mat-card-content
                        style="display: flex; flex-direction: column; gap: 1rem"
                      >
                        <div style="display: flex; gap: 1rem">
                          <drr-input
                            #futureEventNameInput
                            class="drr-single-input"
                            [label]="t('eventName')"
                            [rxFormControl]="upcomingEvent.get('details')"
                            [maxlength]="50"
                          ></drr-input>
                          <drr-datepicker
                            class="drr-single-input"
                            [label]="t('eventDate')"
                            [rxFormControl]="upcomingEvent.get('date')"
                          ></drr-datepicker>
                        </div>
                        <h4>{{ t("contact") }}</h4>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap">
                          <drr-input
                            [label]="'firstName' | transloco"
                            [rxFormControl]="
                              upcomingEvent.get('contact.firstName')
                            "
                            [maxlength]="40"
                          ></drr-input>
                          <drr-input
                            [label]="'lastName' | transloco"
                            [rxFormControl]="
                              upcomingEvent.get('contact.lastName')
                            "
                            [maxlength]="40"
                          ></drr-input>
                          <drr-input
                            [label]="'title' | transloco"
                            [rxFormControl]="upcomingEvent.get('contact.title')"
                            [maxlength]="100"
                          ></drr-input>
                          <drr-input
                            [label]="'department' | transloco"
                            [rxFormControl]="
                              upcomingEvent.get('contact.department')
                            "
                            [maxlength]="40"
                          ></drr-input>
                          <drr-input
                            [label]="'phone' | transloco"
                            [rxFormControl]="upcomingEvent.get('contact.phone')"
                            [maxlength]="10"
                            type="tel"
                          ></drr-input>
                          <drr-input
                            [label]="'email' | transloco"
                            [rxFormControl]="upcomingEvent.get('contact.email')"
                            [maxlength]="100"
                            type="email"
                          ></drr-input>
                        </div>
                        <div>
                          <drr-radio-button
                            class="drr-single-input"
                            [label]="t('provincialRepresentativeRequest')"
                            [options]="yesNoRadioOptions"
                            [rxFormControl]="
                              upcomingEvent.get(
                                'provincialRepresentativeRequest'
                              )
                            "
                          ></drr-radio-button>
                          @if (
                            upcomingEvent.get("provincialRepresentativeRequest")
                              ?.value === true
                          ) {
                            <i style="margin-left: 1rem"
                              >A DMAP team member will be in contact with you
                              regarding the event.</i
                            >
                          }
                        </div>
                      </mat-card-content>
                      @if (getUpcomingEventsArray().controls.length > 1) {
                        <mat-card-actions align="end">
                          <button
                            mat-raised-button
                            color="warn"
                            (click)="removeFutureEvent(i)"
                          >
                            Remove
                          </button>
                        </mat-card-actions>
                      }
                    </mat-card>
                  </div>
                  <button
                    style="margin-top: 1rem; align-self: flex-start"
                    mat-raised-button
                    color="primary"
                    (click)="addFutureEvent()"
                  >
                    Add Future Event
                  </button>
                }
              </div>
            </div>
          </mat-card-content>
        </mat-card>
        <div class="drr-stepper-actions">
          <button mat-stroked-button color="primary" matStepperPrevious>
            Back
          </button>
          <button
            id="next2"
            mat-flat-button
            color="primary"
            matStepperNext
            type="button"
          >
            Next
          </button>
        </div>
      </mat-step>
      <mat-step
        label="Attachments"
        [stepControl]="progressReportForm.get('attachments')!"
        [errorMessage]="'stepError' | transloco"
      >
        <mat-card>
          <mat-card-header>
            <h4>Attachments</h4>
          </mat-card-header>

          <mat-card-content>
            <div class="drr-step-container">
              <drr-attachment
                *ngFor="
                  let attachmentControl of getAttachmentsFormArray().controls;
                  let i = index
                "
                [title]="i == 0 ? t('attachments') : ''"
                [attachmentForm]="attachmentControl"
                (removeFile)="removeFile($event)"
                (downloadFile)="downloadFile($event)"
                [maxCommentsLength]="50"
                [inputType]="'input'"
              ></drr-attachment>

              <div style="display: flex; flex-direction: column; gap: 1rem">
                <div>
                  <h4>
                    {{ t("attachmentUploadText") }}
                  </h4>
                </div>

                <drr-file-upload
                  (filesSelected)="uploadFiles($event)"
                  [attachButtonLabel]="t('uploadAttachment')"
                ></drr-file-upload>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
        <div class="drr-stepper-actions">
          <button mat-stroked-button color="primary" matStepperPrevious>
            Back
          </button>
          <button
            id="next3"
            mat-flat-button
            color="primary"
            matStepperNext
            type="button"
          >
            Next
          </button>
        </div></mat-step
      >
      <mat-step
        label="Review & Declaration"
        [stepControl]="progressReportForm.get('declaration')!"
        [errorMessage]="'stepError' | transloco"
      >
        <div>
          <drif-progress-report-summary
            [progressReportForm]="progressReportForm"
            [isReadOnlyView]="false"
          ></drif-progress-report-summary>

          <drr-auth-rep
            [authorizedRepresentativeForm]="authorizedRepresentativeForm"
          ></drr-auth-rep>

          <drr-declaration
            [declarationForm]="declarationForm"
            [accuracyOfInformationText]="accuracyOfInformationText"
            [authorizedRepresentativeText]="authorizedRepresentativeText"
          ></drr-declaration>
        </div>
        <div class="drr-stepper-actions">
          <button mat-stroked-button color="primary" matStepperPrevious>
            Back
          </button>
          <button
            id="submit"
            mat-flat-button
            color="primary"
            type="button"
            (click)="submit()"
          >
            Submit
          </button>
        </div></mat-step
      >
    </mat-stepper>
  </mat-card-content>
</mat-card>
