<div class="drif-project-container" *transloco="let t; read: 'project'">
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ project?.projectTitle }}</mat-card-title>
      <mat-card-subtitle>{{ project?.proponentName }}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content class="drif-project-details">
      <div>
        <p><strong>Project Number:</strong> {{ project?.projectNumber }}</p>
        <p><strong>Funding Stream:</strong> {{ project?.fundingStream }}</p>
        <p><strong>Program Type:</strong> {{ project?.programType }}</p>
      </div>
      <div>
        <p><strong>Start Date:</strong> {{ project?.startDate }}</p>
        <p><strong>End Date:</strong> {{ project?.endDate }}</p>
        <p><strong>Funding Amount</strong> {{ project?.fundingAmount }}</p>
      </div>
      <div>
        <p><strong>Status:</strong> {{ project?.projectStatus }}</p>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title-group>
        <mat-card-title>Project Contacts</mat-card-title>
        <button mat-raised-button color="primary" (click)="addProjectContact()">
          {{ t("addProjectContact") }}
        </button>
      </mat-card-title-group>
    </mat-card-header>
    <table mat-table [dataSource]="projectContactsDataSource">
      <ng-container matColumnDef="firstName">
        <th mat-header-cell *matHeaderCellDef>First Name</th>
        <td mat-cell *matCellDef="let contact">{{ contact.firstName }}</td>
      </ng-container>
      <ng-container matColumnDef="lastName">
        <th mat-header-cell *matHeaderCellDef>Last Name</th>
        <td mat-cell *matCellDef="let contact">{{ contact.lastName }}</td>
      </ng-container>
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Title</th>
        <td mat-cell *matCellDef="let contact">{{ contact.title }}</td>
      </ng-container>
      <ng-container matColumnDef="department">
        <th mat-header-cell *matHeaderCellDef>Department</th>
        <td mat-cell *matCellDef="let contact">{{ contact.department }}</td>
      </ng-container>
      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef>Phone</th>
        <td mat-cell *matCellDef="let contact">{{ contact.phone }}</td>
      </ng-container>
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>Email</th>
        <td mat-cell *matCellDef="let contact">{{ contact.email }}</td>
      </ng-container>
      <tr
        mat-header-row
        *matHeaderRowDef="[
          'firstName',
          'lastName',
          'title',
          'department',
          'phone',
          'email'
        ]"
      ></tr>
      <tr
        mat-row
        *matRowDef="
          let row;
          columns: [
            'firstName',
            'lastName',
            'title',
            'department',
            'phone',
            'email'
          ]
        "
      ></tr>
    </table>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title-group>
        <mat-card-title>Interim Reports</mat-card-title>
        <button mat-raised-button color="primary" (click)="addInterimReport()">
          {{ t("addInterimReport") }}
        </button>
      </mat-card-title-group>
    </mat-card-header>
    <table
      mat-table
      [dataSource]="interimReportsDataSource"
      multiTemplateDataRows
    >
      @for (column of interimReportsColumns; track column) {
      <ng-container matColumnDef="{{ column }}">
        <th mat-header-cell *matHeaderCellDef>{{ t(column) }}</th>
        <td mat-cell *matCellDef="let element">{{ element[column] }}</td>
      </ng-container>
      }
      <ng-container matColumnDef="expand">
        <th mat-header-cell *matHeaderCellDef aria-label="row actions">
          &nbsp;
        </th>
        <td mat-cell *matCellDef="let element">
          <button
            mat-icon-button
            aria-label="expand row"
            (click)="
              expandedInterimReport =
                expandedInterimReport === element ? null : element;
              $event.stopPropagation()
            "
          >
            @if (expandedInterimReport === element) {
            <mat-icon>keyboard_arrow_up</mat-icon>
            } @else {
            <mat-icon>keyboard_arrow_down</mat-icon>
            }
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="expandedDetail">
        <td
          mat-cell
          *matCellDef="let element"
          [attr.colspan]="interimReportsColumnsWithExpand.length"
          style="padding: 0"
        >
          <div
            class="interim-element-detail"
            [@detailExpand]="
              element == expandedInterimReport ? 'expanded' : 'collapsed'
            "
          >
            <mat-card>
              <div class="interim-element-detail-table">
                <div class="interim-element-detail-table-header">
                  <div>ID</div>
                  <div>Type</div>
                  <div>Date</div>
                  <div>Status</div>
                  <div>Amount</div>
                </div>
                <div class="interim-element-detail-table-row">
                  <div>{{ element.claim.id }}</div>
                  <div>{{ element.claim.claimType }}</div>
                  <div>{{ element.claim.claimDate }}</div>
                  <div>{{ element.claim.claimStatus }}</div>
                  <div>{{ element.claim.claimAmount }}</div>
                </div>
              </div>

              <div class="interim-element-detail-table">
                <div class="interim-element-detail-table-header">
                  <div>ID</div>
                  <div>Type</div>
                  <div>Date</div>
                  <div>Status</div>
                </div>
                <div class="interim-element-detail-table-row">
                  <div>{{ element.report.id }}</div>
                  <div>{{ element.report.reportType }}</div>
                  <div>{{ element.report.reportDate }}</div>
                  <div>{{ element.report.reportStatus }}</div>
                </div>
              </div>

              <div class="interim-element-detail-table">
                <div class="interim-element-detail-table-header">
                  <div>ID</div>
                  <div>Type</div>
                  <div>Date</div>
                  <div>Status</div>
                  <div>Amount</div>
                </div>
                <div class="interim-element-detail-table-row">
                  <div>{{ element.forecast.id }}</div>
                  <div>{{ element.forecast.forecastType }}</div>
                  <div>{{ element.forecast.forecastDate }}</div>
                  <div>{{ element.forecast.forecastStatus }}</div>
                  <div>{{ element.forecast.forecastAmount }}</div>
                </div>
              </div>
            </mat-card>
          </div>
        </td>
      </ng-container>

      <tr
        mat-header-row
        *matHeaderRowDef="interimReportsColumnsWithExpand"
      ></tr>
      <tr
        mat-row
        *matRowDef="let element; columns: interimReportsColumnsWithExpand"
        class="interim-element-row"
        [class.interim-expanded-row]="expandedInterimReport === element"
        (click)="
          expandedInterimReport =
            expandedInterimReport === element ? null : element
        "
      ></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: ['expandedDetail']"
        class="interim-detail-row"
      ></tr>
    </table>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Claims</mat-card-title>
    </mat-card-header>
    <table class="drr-table" mat-table [dataSource]="claimsDataSource">
      <ng-container
        *ngFor="let column of claimsColumns"
        [matColumnDef]="column"
      >
        <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
        <td mat-cell *matCellDef="let claim">{{ claim[column] }}</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="claimsColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: claimsColumns"></tr>
    </table>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Progress Reports</mat-card-title>
    </mat-card-header>
    <table mat-table [dataSource]="progressReportsDataSource">
      <ng-container
        *ngFor="let column of progressReportsColumns"
        [matColumnDef]="column"
      >
        <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
        <td mat-cell *matCellDef="let report">{{ report[column] }}</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="progressReportsColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: progressReportsColumns"></tr>
    </table>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Forecasts</mat-card-title>
    </mat-card-header>
    <table mat-table [dataSource]="forecastsDataSource">
      <ng-container
        *ngFor="let column of forecastsColumns"
        [matColumnDef]="column"
      >
        <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
        <td mat-cell *matCellDef="let forecast">{{ forecast[column] }}</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="forecastsColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: forecastsColumns"></tr>
    </table>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Attachments</mat-card-title>
    </mat-card-header>
    <table mat-table [dataSource]="attachmentsDataSource">
      <ng-container
        *ngFor="let column of attachmentsColumns"
        [matColumnDef]="column"
      >
        <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
        <td mat-cell *matCellDef="let attachment">{{ attachment[column] }}</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="attachmentsColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: attachmentsColumns"></tr>
    </table>
  </mat-card>
</div>
